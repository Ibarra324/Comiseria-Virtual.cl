<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Carabineros | Chile Centro RolePlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Estilos adicionales para la tabla de trámites */
        body {
            background-color: #e9ecef;
        }

        .admin-container {
            max-width: 1200px;
        }

        .tramites-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .tramites-table th, .tramites-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .tramites-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .tramite-actions {
            display: flex;
            gap: 10px;
        }

        .btn-accept, .btn-deny {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            border: none;
            color: white;
        }

        .btn-accept {
            background-color: #28a745;
        }

        .btn-accept:hover {
            background-color: #1e7e34;
        }

        .btn-deny {
            background-color: #dc3545;
        }

        .btn-deny:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-user-info">
            <div id="adminUserProfile" class="admin-user-profile hidden">
                <span>Bienvenido,</span>
                <span id="adminUserName"></span>
                <img id="adminUserAvatar" src="" alt="Avatar de Carabinero">
            </div>
        </div>
        <h1 class="admin-header">Panel de Carabineros</h1>

        <div id="accessDenied" class="admin-message admin-access-denied" style="display:none;">
            <strong>Acceso Denegado:</strong> No tienes los permisos necesarios para acceder a este panel. Serás redirigido en breve.
        </div>

        <div id="adminContent" style="display:none;">
            <p class="admin-message">Aquí podrás ver y gestionar los trámites enviados por los ciudadanos.</p>
            <h2>Trámites Pendientes</h2>
            <table class="tramites-table" id="tramiteTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tipo de Trámite</th>
                        <th>Usuario</th>
                        <th>Fecha de Envío</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tramiteList">
                        </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const accessDeniedDiv = document.getElementById('accessDenied');
            const adminContentDiv = document.getElementById('adminContent');
            const tramiteTable = document.getElementById('tramiteTable');
            const tramiteList = document.getElementById('tramiteList');
            const adminUserProfileDiv = document.getElementById('adminUserProfile');
            const adminUserAvatarImg = document.getElementById('adminUserAvatar');
            const adminUserNameSpan = document.getElementById('adminUserName');
            const storedAuthTokenAdmin = localStorage.getItem('authToken'); // Ejemplo básico

            if (storedAuthTokenAdmin) {
                // ** Aquí DEBERÍAS hacer una petición real a tu backend para verificar el rol
                // y obtener los datos del usuario y los trámites PENDIENTES. **
                const mockAdminUser = { roles: ['carabinero'], username: 'AdminUsuario', avatarUrl: 'https://via.placeholder.com/40/0000FF/FFFFFF?Text=CA' };
                if (mockAdminUser.roles && mockAdminUser.roles.includes('carabinero')) {
                    adminContentDiv.style.display = 'block';
                    adminUserProfileDiv.classList.remove('hidden');
                    adminUserAvatarImg.src = mockAdminUser.avatarUrl;
                    adminUserNameSpan.textContent = mockAdminUser.username;

                    // ** Simulación de datos de trámites PENDIENTES (esto vendría del backend) **
                    const tramitesPendientes = [
                        { id: 1, tipo: 'Hurto Simple', usuario: 'Ciudadano123', fecha: '2025-05-31', estado: 'Pendiente' },
                        { id: 2, tipo: 'Robo de Vehiculo', usuario: 'Usuario456', fecha: '2025-05-30', estado: 'Pendiente' },
                        { id: 3, tipo: 'Estafa', usuario: 'OtroUsuario', fecha: '2025-05-29', estado: 'Pendiente' }
                        // Agrega más trámites pendientes aquí
                    ];

                    function renderTramites(tramites) {
                        tramiteList.innerHTML = ''; // Limpiar la tabla
                        tramites.forEach(tramite => {
                            const row = tramiteList.insertRow();
                            row.insertCell().textContent = tramite.id;
                            row.insertCell().textContent = tramite.tipo;
                            row.insertCell().textContent = tramite.usuario;
                            row.insertCell().textContent = tramite.fecha;
                            row.insertCell().textContent = tramite.estado;
                            const actionsCell = row.insertCell();
                            const acceptButton = document.createElement('button');
                            acceptButton.textContent = 'Aceptar';
                            acceptButton.classList.add('btn-accept');
                            acceptButton.addEventListener('click', () => handleAcceptTramite(tramite.id));

                            const denyButton = document.createElement('button');
                            denyButton.textContent = 'Denegar';
                            denyButton.classList.add('btn-deny');
                            denyButton.addEventListener('click', () => handleDenyTramite(tramite.id));

                            actionsCell.appendChild(acceptButton);
                            actionsCell.appendChild(denyButton);
                        });
                    }

                    renderTramites(tramitesPendientes);

                    function handleAcceptTramite(tramiteId) {
                        console.log(`Aceptar trámite con ID: ${tramiteId}`);
                        // ** Aquí DEBERÍAS hacer una petición al backend para marcar el trámite como aceptado. **
                        // fetch('/api/tramites/' + tramiteId + '/aceptar', { method: 'POST' })
                        //   .then(response => response.json())
                        //   .then(data => {
                        //     // Actualizar la tabla o mostrar un mensaje
                        //     console.log(data);
                        //   });
                    }

                    function handleDenyTramite(tramiteId) {
                        console.log(`Denegar trámite con ID: ${tramiteId}`);
                        // ** Aquí DEBERÍAS hacer una petición al backend para marcar el trámite como denegado. **
                        // fetch('/api/tramites/' + tramiteId + '/denegar', { method: 'POST' })
                        //   .then(response => response.json())
                        //   .then(data => {
                        //     // Actualizar la tabla o mostrar un mensaje
                        //     console.log(data);
                        //   });
                    }

                } else {
                    accessDeniedDiv.style.display = 'block';
                    setTimeout(() => {
                        window.location.href = '../';
                    }, 3000);
                }
            } else {
                accessDeniedDiv.style.display = 'block';
                setTimeout(() => {
                    window.location.href = '../';
                }, 3000);
            }
        });
    </script>
</body>
</html>
